{"version":3,"sources":["pages/GuideDispatchBondPage.jsx"],"names":["bondColumns","connect","state","id_branch_office","enterpriseSucursal","configGeneral","configs","config","configStore","props","useState","displayLoading","setDisplayLoading","invoice","setInvoice","bonds","setBonds","typeBond","setTypeBond","isShow","setIsShow","disableButton","validated","setValidated","notify_client","amount","id_type_bond","detail","date_payment_bond","moment","tz","format","formBond","setFormBond","count","id_branch","useEffect","fetchData","setTimeout","history","replace","is_syncronized","toast","error","fetchTypeBond","useMemo","Header","accessor","props1","type_bond","name","showPriceWithDecimals","Cell","variant","className","simbolo_moneda","cell","row","original","status","size","id","title","block","Item","onClick","modifyRegisterBond","deleteRegisterBond","match","params","promise","axios","get","API_URL","Promise","all","then","result","data","catch","err","tokenExpired","handleModalBond","onChange","e","target","checked","value","datos","confirmAlert","customUI","onClose","confirmDeleteRegister","delete","success","fluid","sm","md","lg","ref","type","isGuide","length","wb","xlsx","book_new","bodyTable","Props","Title","Subject","Author","CreatedDate","SheetNames","push","forEach","item","i","ws","aoa_to_sheet","Sheets","wbout","bookType","s2ab","FileSaver","saveAs","Blob","disabled","responseType","window","open","columns","show","onHide","aria-labelledby","centered","closeButton","onSubmit","form","currentTarget","preventDefault","checkValidity","stopPropagation","objectPost","Object","assign","id_invoice","put","post","noValidate","Body","label","required","messageErrors","cols","handleChange","map","v","key","step","Footer"],"mappings":"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","file":"static/js/66.cb004128.chunk.js","sourcesContent":["import React, {useState, useEffect, useMemo} from 'react'\r\nimport PropTypes from 'prop-types'\r\nimport {connect} from 'react-redux'\r\nimport {API_URL} from 'utils/constants'\r\nimport 'styles/components/modalComponents.css'\r\nimport {\r\n  Row,\r\n  Col,\r\n  Container,\r\n  Button,\r\n  Badge,\r\n  Modal,\r\n  Form,\r\n  DropdownButton,\r\n  Dropdown,\r\n  Image\r\n} from 'react-bootstrap'\r\nimport InvoiceBondComponent from 'components/InvoiceBondComponent'\r\nimport axios from 'axios'\r\nimport { toast } from 'react-toastify'\r\nimport {FaPlusCircle, FaRegFileCode , FaRegFilePdf} from 'react-icons/fa'\r\nimport InputField from 'components/input/InputComponent'\r\nimport * as moment from 'moment-timezone'\r\nimport { confirmAlert } from 'react-confirm-alert'; // Import\r\n\r\nimport {showPriceWithDecimals, s2ab} from 'utils/functions'\r\nimport * as xlsx from 'xlsx'\r\nimport Table from 'components/Table'\r\nimport FileSaver from 'file-saver'\r\nimport LoadingComponent from 'components/LoadingComponent'\r\n\r\nlet bondColumns = []\r\n\r\nconst GuideDispatchBondPage = (props) => {\r\n  \r\n  const [displayLoading, setDisplayLoading] = useState(true)\r\n  const [invoice,setInvoice] = useState(null)\r\n  const [bonds, setBonds] = useState([])\r\n  const [typeBond, setTypeBond] = useState([])\r\n  const [isShow, setIsShow] = useState(false)\r\n  const [disableButton, setDisableButton] = useState(false)\r\n  const [validated, setValidated] = useState(false)\r\n  const [formBond, setFormBond] = useState({\r\n    notify_client: false,\r\n    amount: \"\",\r\n    id_type_bond: \"\",\r\n    detail: \"\",\r\n    date_payment_bond: moment().tz('America/Santiago').format('YYYY-MM-DD')\r\n  })\r\n\r\n  let count = 0\r\n  let id_branch = null\r\n\r\n  useEffect(() => {\r\n    if(count === 0){\r\n      id_branch = props.id_branch_office\r\n      count++\r\n      fetchData()\r\n    }else{\r\n      if(id_branch !== props.id_branch_office){\r\n        setTimeout(function () {\r\n          props.history.replace('/invoice/invoice_search')\r\n        }, 1500);\r\n      }else{\r\n        count++\r\n        fetchData()\r\n      }\r\n    }\r\n  },[props.id_branch_office])\r\n\r\n  useEffect(() => {\r\n    if(!props.configStore || !props.configGeneral){\r\n      if(!props.configStore){\r\n        toast.error('Debe hacer su configuración de tienda o seleccionar una sucursal para usar este módulo')\r\n        setTimeout(function () {\r\n          props.history.replace('/dashboard')\r\n        }, 3000);\r\n      }else if(!props.configGeneral){\r\n        toast.error('Debe hacer su configuración general para usar este módulo')\r\n        setTimeout(function () {\r\n          props.history.replace('/dashboard')\r\n        }, 3000);\r\n      }\r\n    }else{\r\n      let config_general = props.configGeneral\r\n      if(!config_general.is_syncronized){\r\n        toast.error('Su cuenta no esta sincronizada con el SII, complete su configuración general para usar este módulo')\r\n        setTimeout(function () {\r\n          props.history.replace('/dashboard')\r\n        }, 3000);\r\n        return\r\n      }\r\n      fetchTypeBond()\r\n    }\r\n  },[])\r\n\r\n  useMemo(() => {\r\n    bondColumns = [\r\n      {\r\n        Header: 'Fecha',\r\n        accessor: props1 => [moment(props1.date_payment_bond).format('DD-MM-YYYY')],\r\n      },\r\n      {\r\n        Header: 'Detalle',\r\n        accessor: 'detail',\r\n      },\r\n      {\r\n        Header: 'Tipo de Abono',\r\n        accessor: props1 => [props1.type_bond.name],\r\n      },\r\n      {\r\n        Header: 'Monto',\r\n        accessor: props1 => [showPriceWithDecimals(props.configGeneral,props1.amount)],\r\n        Cell : props1 => {\r\n          return <Badge variant=\"danger\" className=\"font-badge\">{props.configGeneral ? props.configGeneral.simbolo_moneda : '' }{showPriceWithDecimals(props.configGeneral,props1.cell.row.original.amount)}</Badge>\r\n        }\r\n      },\r\n      {\r\n        Header: 'Acciones',\r\n        Cell: props1 => {\r\n          const original = props1.cell.row.original\r\n          if(invoice && invoice.status === 2){\r\n            return ''\r\n          }else{\r\n            return(\r\n              <DropdownButton size=\"sm\" id={'drop'+original.id} title=\"Seleccione\"  block=\"true\">\r\n                <Dropdown.Item onClick={() => modifyRegisterBond(original)}>Modificar</Dropdown.Item>\r\n                <Dropdown.Item onClick={() => deleteRegisterBond(original)}>Eliminar</Dropdown.Item>\r\n              </DropdownButton>\r\n            )\r\n          }\r\n        }\r\n      }\r\n    ]\r\n  },[invoice])\r\n\r\n  const fetchData = () => {\r\n    const id = props.match.params.id\r\n    const promise = [\r\n      axios.get(API_URL+'invoice/'+id+\"/\"+4),\r\n    ]\r\n    Promise.all(promise).then(result => {\r\n      setInvoice(result[0].data)\r\n      setBonds(result[0].data.bonds)\r\n      setDisplayLoading(false)\r\n    }).catch(err => {\r\n      setDisplayLoading(false)\r\n      props.tokenExpired(err)\r\n    })\r\n  }\r\n\r\n  const fetchTypeBond = () => {\r\n    axios.get(API_URL+'type_bond').then(result => {\r\n        setTypeBond(result.data)\r\n      }).catch(err => {\r\n        props.tokenExpired(err)\r\n    })\r\n  }\r\n\r\n  const handleSubmitBold = e => {\r\n    const form = e.currentTarget;\r\n    e.preventDefault();\r\n    if (form.checkValidity() === false) {\r\n      e.stopPropagation();\r\n      setValidated(true);\r\n      return\r\n    }\r\n\r\n    let objectPost = Object.assign({},formBond,{\r\n      id_invoice: props.match.params.id\r\n    })\r\n    setDisplayLoading(true)\r\n    if(objectPost.id){\r\n      axios.put(API_URL+'invoice_bonds/'+objectPost.id,objectPost).then(result => {\r\n        toast.success('Abono modificado con éxito')\r\n        handleModalBond()\r\n        fetchData()\r\n      }).catch(err => {\r\n        setDisplayLoading(false)\r\n        props.tokenExpired(err)\r\n      })\r\n    }else{\r\n      axios.post(API_URL+'invoice_bonds',objectPost).then(result => {\r\n        toast.success('Abono agregado con éxito')\r\n        handleModalBond()\r\n        fetchData()\r\n      }).catch(err => {\r\n        setDisplayLoading(false)\r\n        props.tokenExpired(err)\r\n      })\r\n    }\r\n  }\r\n\r\n  const handleModalBond = () => {\r\n    if(isShow){\r\n      setFormBond({\r\n        notify_client: false,\r\n        amount: \"\",\r\n        id_type_bond: \"\",\r\n        detail: \"\",\r\n        date_payment_bond: moment().tz('America/Santiago').format('YYYY-MM-DD')\r\n      })\r\n    }\r\n    setIsShow(!isShow)\r\n\r\n  }\r\n\r\n  const onChange = e => {\r\n    setFormBond({...formBond, [e.target.name] : e.target.name === \"notify_client\" ? e.target.checked : e.target.value})\r\n  }\r\n\r\n  const modifyRegisterBond = datos => {\r\n    setFormBond({\r\n      notify_client: datos.notify_client,\r\n      amount: datos.amount,\r\n      id_type_bond: datos.id_type_bond,\r\n      detail: datos.detail,\r\n      date_payment_bond: moment(datos.date_payment_bond).tz('America/Santiago').format('YYYY-MM-DD'),\r\n      id: datos.id\r\n    })\r\n\r\n    handleModalBond()\r\n  }\r\n\r\n  const deleteRegisterBond = datos => {\r\n    confirmAlert({\r\n      customUI: ({ onClose }) => {\r\n        return (\r\n          <div className='custom-ui-edit'>\r\n            <h1>¿Esta seguro?</h1>\r\n            <p className=\"font-alert\">¿Desea realmente borrar este registro?</p>\r\n            <button className=\"button-alert\"\r\n              onClick={() => {\r\n                confirmDeleteRegister(datos.id);\r\n                onClose();\r\n              }}\r\n            >\r\n              Si, Aceptar\r\n            </button>\r\n            <button className=\"button-alert\" onClick={onClose}>No</button>\r\n          </div>\r\n        );\r\n      }\r\n    });\r\n  }\r\n\r\n  const confirmDeleteRegister = id  => {\r\n    setDisplayLoading(true)\r\n    axios.delete(API_URL+'invoice_bonds/'+id).then(result => {\r\n     toast.success('Abono eliminado con éxito')\r\n     fetchData()\r\n    }).catch(err => {\r\n      setDisplayLoading(false)\r\n      props.tokenExpired(err)\r\n    })\r\n  }\r\n\r\n  const exportToExcel = () => {\r\n\r\n    if(bonds.length < 1){\r\n      toast.error('Error, no hay abonos para realizar el excel')\r\n    }else{\r\n      setDisplayLoading(true)\r\n      let wb = xlsx.utils.book_new()\r\n      let bodyTable = [['Fecha','Detalle','Tipo de Abono','Monto']]\r\n\r\n      wb.Props = {\r\n        Title: \"Pagos abonados de la guía de despacho \"+invoice.ref,\r\n        Subject: \"Exportación de Data\",\r\n        Author: 'Aidy tecnology',\r\n        CreatedDate: moment().format('YYYY-MM-DD')\r\n      };\r\n      wb.SheetNames.push(\"Pagos\");\r\n\r\n      bonds.forEach((item, i) => {\r\n        bodyTable.push([\r\n          moment(item.date_payment_bond).format('DD-MM-YYYY'),\r\n          item.detail,\r\n          item.type_bond.name,\r\n          showPriceWithDecimals(props.configGeneral,item.amount)\r\n        ])\r\n      });\r\n\r\n      var ws = xlsx.utils.aoa_to_sheet(bodyTable);\r\n      wb.Sheets[\"Pagos\"] = ws;\r\n      var wbout = xlsx.write(wb, {bookType:'xlsx',  type: 'binary'});\r\n      let datos = s2ab(wbout)\r\n      FileSaver.saveAs(new Blob([datos],{type:\"application/octet-stream\"}), 'Abonos de la nota de venta '+invoice.ref+\" fecha: \"+moment().tz('America/Santiago').format('DD-MM-YYYY')+'.xlsx')\r\n      setDisplayLoading(false)\r\n    }\r\n\r\n  }\r\n\r\n  const exportToPdf = () => {\r\n    if(bonds.length > 0){\r\n      setDisplayLoading(true)\r\n      axios.get(API_URL+'print_invoice_bonds/'+props.match.params.id+'/2',{\r\n        responseType: 'blob'\r\n      }).then(result => {\r\n        FileSaver.saveAs(result.data,'Informe de los pagos de la guía: '+invoice.ref+' fecha: '+moment().tz('America/Santiago').format('DD-MM-YYYY')+\".pdf\")\r\n        setDisplayLoading(false)\r\n      }).catch(err => {\r\n        setDisplayLoading(false)\r\n        props.tokenExpired(err)\r\n      })\r\n    }else{\r\n      toast.error('No hay pagos para realizar el informe')\r\n    }\r\n  }\r\n\r\n  const goToInvoice = () => {\r\n    props.history.replace('/guide/guide_search')\r\n  }\r\n\r\n  const printInvoice = () => {\r\n    setDisplayLoading(true)\r\n    axios.get(API_URL+'invoice_print/'+props.match.params.id+\"/0/2\",).then(result => {\r\n      window.open(API_URL+'documents/sale_note/files_pdf/'+result.data.name)\r\n      setDisplayLoading(false)\r\n    }).catch(err => {\r\n      setDisplayLoading(false)\r\n      props.tokenExpired(err)\r\n    })\r\n  }\r\n\r\n  return (\r\n    <Container fluid>\r\n      <Row>\r\n        <Col sm={7} md={7} lg={7}>\r\n          <h4 className=\"title_principal\">Historial de Pagos de la Guía {invoice  ? (<Badge variant=\"danger\" className=\"font-badge\">{invoice.ref}</Badge>) : ''}</h4>\r\n        </Col>\r\n        <Col sm={5} md={5} lg={5}>\r\n          <Button variant=\"primary\" block={true} type=\"button\" onClick={goToInvoice} size=\"sm\">Volver a las Guías</Button>\r\n        </Col>\r\n      </Row>\r\n      {displayLoading ? (\r\n        <LoadingComponent />\r\n      ) : (\r\n        <>\r\n          <InvoiceBondComponent\r\n            invoice={invoice}\r\n            configGeneral={props.configGeneral}\r\n            configStore={props.configStore}\r\n            isGuide={true}\r\n          />\r\n          <br/>\r\n          <Row>\r\n            <Col sm={3} md={3} lg={3}>\r\n              <Button variant=\"success\" block={true} type=\"button\" onClick={exportToExcel} size=\"sm\">Exportar a Excel <FaRegFileCode /></Button>\r\n            </Col>\r\n            <Col sm={3} md={3} lg={3}>\r\n              <Button variant=\"success\" block={true} type=\"button\" onClick={handleModalBond} size=\"sm\" disabled={invoice && invoice.status === 2 ? true : false}>Agregar Abono <FaPlusCircle /></Button>\r\n            </Col>\r\n            <Col sm={3} md={3} lg={3}>\r\n              <Button variant=\"success\" block={true} type=\"button\" onClick={exportToPdf} size=\"sm\">Exportar a Pdf <FaRegFilePdf /></Button>\r\n            </Col>\r\n            <Col sm={3} md={3} lg={3}>\r\n              <Button variant=\"success\" block={true} type=\"button\" onClick={printInvoice} size=\"sm\">Imprimir Factura <FaRegFilePdf /></Button>\r\n            </Col>\r\n          </Row>\r\n          <Row>\r\n            <Col sm={12} md={12} lg={12}>\r\n              <br/>\r\n              <Table columns={bondColumns} data={bonds} />\r\n            </Col>\r\n          </Row>\r\n        </>\r\n      )}\r\n\r\n      <Modal\r\n        show={isShow}\r\n        onHide={handleModalBond}\r\n        size=\"xl\"\r\n        aria-labelledby=\"contained-modal-title-vcenter\"\r\n        centered\r\n      >\r\n        <Modal.Header closeButton className=\"header_dark\">\r\n          <Modal.Title id=\"contained-modal-title-vcenter\">\r\n            Agregar Abono $\r\n          </Modal.Title>\r\n        </Modal.Header>\r\n        <Form onSubmit={handleSubmitBold} noValidate validated={validated}>\r\n          <>\r\n            {displayLoading ? (\r\n              <Modal.Body>\r\n                <LoadingComponent />\r\n              </Modal.Body>\r\n            ) : (\r\n              <Modal.Body>\r\n                <Row>\r\n                  <InputField\r\n                  type='date'\r\n                  label='Fecha del Pago'\r\n                  name='date_payment_bond'\r\n                  required={true}\r\n                  messageErrors={[\r\n                  'Requerido*'\r\n                  ]}\r\n                  cols='col-md-4 col-lg-4 col-sm-4'\r\n                  value={formBond.date_payment_bond}\r\n                  handleChange={onChange}\r\n                  />\r\n                <InputField\r\n                  type='select'\r\n                  label='Tipo de Abono'\r\n                  name='id_type_bond'\r\n                  required={true}\r\n                  messageErrors={[\r\n                  'Requerido*'\r\n                  ]}\r\n                  cols='col-md-4 col-lg-4 col-sm-4'\r\n                  value={formBond.id_type_bond}\r\n                  handleChange={onChange}\r\n                  >\r\n                  <option value=\"\">--Seleccione--</option>\r\n                  {typeBond.map((v,i) => (\r\n                    <option value={v.id} key={i}>{v.name}</option>\r\n                  ))}\r\n                </InputField>\r\n                  <InputField\r\n                  type='number'\r\n                  step=\"any\"\r\n                  label='Monto'\r\n                  name='amount'\r\n                  required={true}\r\n                  messageErrors={[\r\n                  'Requerido*'\r\n                  ]}\r\n                  cols='col-md-4 col-lg-4 col-sm-4'\r\n                  value={formBond.amount}\r\n                  handleChange={onChange}\r\n                  />\r\n                </Row>\r\n                <Row>\r\n                  <InputField\r\n                  type='text'\r\n                  label='Detalle'\r\n                  name='detail'\r\n                  required={false}\r\n                  messageErrors={[\r\n                  'Requerido*'\r\n                  ]}\r\n                  cols='col-md-4 col-lg-4 col-sm-4'\r\n                  value={formBond.detail}\r\n                  handleChange={onChange}\r\n                  />\r\n                {/*\r\n                  <Col sm={4} md={4} lg={4}>\r\n                    <br/>\r\n                    <Form.Group>\r\n                      <Form.Check\r\n                        name=\"notify_client\"\r\n                        type={'checkbox'}\r\n                        id={`checkbox-1`}\r\n                        label={`Notificar al Cliente`}\r\n                        checked={formBond.notify_client}\r\n                        onChange={onChange}\r\n                        />\r\n                    </Form.Group>\r\n                  </Col>*/}\r\n                </Row>\r\n              </Modal.Body>\r\n            )}\r\n          </>\r\n          <Modal.Footer>\r\n            <Button size=\"md\" type=\"submit\" variant=\"primary\"  disabled={disableButton}>Enviar</Button>\r\n            <Button size=\"md\" variant=\"secondary\" onClick={handleModalBond} disabled={disableButton}>cerrar</Button>\r\n          </Modal.Footer>\r\n        </Form>\r\n      </Modal>\r\n    </Container>\r\n  )\r\n}\r\n\r\n\r\nGuideDispatchBondPage.propTypes = {\r\n  id_branch_office: PropTypes.any.isRequired,\r\n  configGeneral : PropTypes.object.isRequired,\r\n  configStore: PropTypes.object.isRequired\r\n}\r\n\r\nfunction mapStateToProps(state){\r\n  return {\r\n    id_branch_office: state.enterpriseSucursal.id_branch_office,\r\n    configGeneral : state.configs.config,\r\n    configStore: state.configs.configStore\r\n  }\r\n}\r\n\r\nexport default connect(mapStateToProps,{})(GuideDispatchBondPage)\r\n"],"sourceRoot":""}