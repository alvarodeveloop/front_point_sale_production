(this["webpackJsonpappwork-react-starter"]=this["webpackJsonpappwork-react-starter"]||[]).push([[63],{902:function(e,a,t){"use strict";t.r(a);var n=t(34),o=t(22),c=t(20),r=t(1),i=t.n(r),l=t(29),s=t(15),u=(t(691),t(687)),d=t(714),m=t(655),b=t(654),f=t(134),p=t(87),g=t(132),E=t(909),h=t(49),_=t(763),y=t(12),v=t.n(y),k=t(9),Y=t(19),j=t(88),O=t(176),S=t(694),D=t(23),A=t(744),x=t(690),M=t(721),C=t.n(M),z=t(109),G=[];a.default=Object(l.b)((function(e){return{id_branch_office:e.enterpriseSucursal.id_branch_office,configGeneral:e.configs.config,configStore:e.configs.configStore}}),{})((function(e){var a=Object(r.useState)(!0),t=Object(c.a)(a,2),l=t[0],y=t[1],M=Object(r.useState)(null),w=Object(c.a)(M,2),T=w[0],N=w[1],P=Object(r.useState)([]),q=Object(c.a)(P,2),H=q[0],F=q[1],I=Object(r.useState)([]),B=Object(c.a)(I,2),R=B[0],V=B[1],J=Object(r.useState)(!1),U=Object(c.a)(J,2),$=U[0],K=U[1],L=Object(r.useState)(!1),Q=Object(c.a)(L,2),W=Q[0],X=(Q[1],Object(r.useState)(!1)),Z=Object(c.a)(X,2),ee=Z[0],ae=Z[1],te=Object(r.useState)({notify_client:!1,amount:"",id_type_bond:"",detail:"",date_payment_bond:O().tz("America/Santiago").format("YYYY-MM-DD")}),ne=Object(c.a)(te,2),oe=ne[0],ce=ne[1],re=0,ie=null;Object(r.useEffect)((function(){0===re?(ie=e.id_branch_office,re++,le()):ie!==e.id_branch_office?setTimeout((function(){e.history.replace("/invoice/invoice_search")}),1500):(re++,le())}),[e.id_branch_office]),Object(r.useEffect)((function(){if(e.configStore&&e.configGeneral){if(!e.configGeneral.is_syncronized)return k.b.error("Su cuenta no esta sincronizada con el SII, complete su configuraci\xf3n general para usar este m\xf3dulo"),void setTimeout((function(){e.history.replace("/dashboard")}),3e3);se()}else e.configStore?e.configGeneral||(k.b.error("Debe hacer su configuraci\xf3n general para usar este m\xf3dulo"),setTimeout((function(){e.history.replace("/dashboard")}),3e3)):(k.b.error("Debe hacer su configuraci\xf3n de tienda o seleccionar una sucursal para usar este m\xf3dulo"),setTimeout((function(){e.history.replace("/dashboard")}),3e3))}),[]),Object(r.useMemo)((function(){G=[{Header:"Fecha",accessor:function(e){return[O(e.date_payment_bond).format("DD-MM-YYYY")]}},{Header:"Detalle",accessor:"detail"},{Header:"Tipo de Abono",accessor:function(e){return[e.type_bond.name]}},{Header:"Monto",accessor:function(a){return[Object(D.g)(e.configGeneral,a.amount)]},Cell:function(a){return i.a.createElement(u.a,{variant:"danger",className:"font-badge"},e.configGeneral?e.configGeneral.simbolo_moneda:"",Object(D.g)(e.configGeneral,a.cell.row.original.amount))}},{Header:"Acciones",Cell:function(e){var a=e.cell.row.original;return T&&2===T.status?"":i.a.createElement(d.a,{size:"sm",id:"drop"+a.id,title:"Seleccione",block:"true"},i.a.createElement(m.a.Item,{onClick:function(){return me(a)}},"Modificar"),i.a.createElement(m.a.Item,{onClick:function(){return be(a)}},"Eliminar"))}}]}),[T]);var le=function(){var a=e.match.params.id,t=[v.a.get(s.b+"invoice/"+a+"/4")];Promise.all(t).then((function(e){N(e[0].data),F(e[0].data.bonds),y(!1)})).catch((function(a){y(!1),e.tokenExpired(a)}))},se=function(){v.a.get(s.b+"type_bond").then((function(e){V(e.data)})).catch((function(a){e.tokenExpired(a)}))},ue=function(){$&&ce({notify_client:!1,amount:"",id_type_bond:"",detail:"",date_payment_bond:O().tz("America/Santiago").format("YYYY-MM-DD")}),K(!$)},de=function(e){ce(Object(o.a)(Object(o.a)({},oe),{},Object(n.a)({},e.target.name,"notify_client"===e.target.name?e.target.checked:e.target.value)))},me=function(e){ce({notify_client:e.notify_client,amount:e.amount,id_type_bond:e.id_type_bond,detail:e.detail,date_payment_bond:O(e.date_payment_bond).tz("America/Santiago").format("YYYY-MM-DD"),id:e.id}),ue()},be=function(e){Object(S.confirmAlert)({customUI:function(a){var t=a.onClose;return i.a.createElement("div",{className:"custom-ui-edit"},i.a.createElement("h1",null,"\xbfEsta seguro?"),i.a.createElement("p",{className:"font-alert"},"\xbfDesea realmente borrar este registro?"),i.a.createElement("button",{className:"button-alert",onClick:function(){fe(e.id),t()}},"Si, Aceptar"),i.a.createElement("button",{className:"button-alert",onClick:t},"No"))}})},fe=function(a){y(!0),v.a.delete(s.b+"invoice_bonds/"+a).then((function(e){k.b.success("Abono eliminado con \xe9xito"),le()})).catch((function(a){y(!1),e.tokenExpired(a)}))};return i.a.createElement(b.a,{fluid:!0},i.a.createElement(f.a,null,i.a.createElement(p.a,{sm:7,md:7,lg:7},i.a.createElement("h4",{className:"title_principal"},"Historial de Pagos de la Gu\xeda ",T?i.a.createElement(u.a,{variant:"danger",className:"font-badge"},T.ref):"")),i.a.createElement(p.a,{sm:5,md:5,lg:5},i.a.createElement(g.a,{variant:"primary",block:!0,type:"button",onClick:function(){e.history.replace("/guide/guide_search")},size:"sm"},"Volver a las Gu\xedas"))),l?i.a.createElement(z.a,null):i.a.createElement(i.a.Fragment,null,i.a.createElement(_.a,{invoice:T,configGeneral:e.configGeneral,configStore:e.configStore,isGuide:!0}),i.a.createElement("br",null),i.a.createElement(f.a,null,i.a.createElement(p.a,{sm:3,md:3,lg:3},i.a.createElement(g.a,{variant:"success",block:!0,type:"button",onClick:function(){if(H.length<1)k.b.error("Error, no hay abonos para realizar el excel");else{y(!0);var a=A.utils.book_new(),t=[["Fecha","Detalle","Tipo de Abono","Monto"]];a.Props={Title:"Pagos abonados de la gu\xeda de despacho "+T.ref,Subject:"Exportaci\xf3n de Data",Author:"Aidy tecnology",CreatedDate:O().format("YYYY-MM-DD")},a.SheetNames.push("Pagos"),H.forEach((function(a,n){t.push([O(a.date_payment_bond).format("DD-MM-YYYY"),a.detail,a.type_bond.name,Object(D.g)(e.configGeneral,a.amount)])}));var n=A.utils.aoa_to_sheet(t);a.Sheets.Pagos=n;var o=A.write(a,{bookType:"xlsx",type:"binary"}),c=Object(D.e)(o);C.a.saveAs(new Blob([c],{type:"application/octet-stream"}),"Abonos de la nota de venta "+T.ref+" fecha: "+O().tz("America/Santiago").format("DD-MM-YYYY")+".xlsx"),y(!1)}},size:"sm"},"Exportar a Excel ",i.a.createElement(Y.E,null))),i.a.createElement(p.a,{sm:3,md:3,lg:3},i.a.createElement(g.a,{variant:"success",block:!0,type:"button",onClick:ue,size:"sm",disabled:!(!T||2!==T.status)},"Agregar Abono ",i.a.createElement(Y.C,null))),i.a.createElement(p.a,{sm:3,md:3,lg:3},i.a.createElement(g.a,{variant:"success",block:!0,type:"button",onClick:function(){H.length>0?(y(!0),v.a.get(s.b+"print_invoice_bonds/"+e.match.params.id+"/2",{responseType:"blob"}).then((function(e){C.a.saveAs(e.data,"Informe de los pagos de la gu\xeda: "+T.ref+" fecha: "+O().tz("America/Santiago").format("DD-MM-YYYY")+".pdf"),y(!1)})).catch((function(a){y(!1),e.tokenExpired(a)}))):k.b.error("No hay pagos para realizar el informe")},size:"sm"},"Exportar a Pdf ",i.a.createElement(Y.G,null))),i.a.createElement(p.a,{sm:3,md:3,lg:3},i.a.createElement(g.a,{variant:"success",block:!0,type:"button",onClick:function(){y(!0),v.a.get(s.b+"invoice_print/"+e.match.params.id+"/0/2").then((function(e){window.open(s.b+"documents/sale_note/files_pdf/"+e.data.name),y(!1)})).catch((function(a){y(!1),e.tokenExpired(a)}))},size:"sm"},"Imprimir Factura ",i.a.createElement(Y.G,null)))),i.a.createElement(f.a,null,i.a.createElement(p.a,{sm:12,md:12,lg:12},i.a.createElement("br",null),i.a.createElement(x.a,{columns:G,data:H})))),i.a.createElement(E.a,{show:$,onHide:ue,size:"xl","aria-labelledby":"contained-modal-title-vcenter",centered:!0},i.a.createElement(E.a.Header,{closeButton:!0,className:"header_dark"},i.a.createElement(E.a.Title,{id:"contained-modal-title-vcenter"},"Agregar Abono $")),i.a.createElement(h.a,{onSubmit:function(a){var t=a.currentTarget;if(a.preventDefault(),!1===t.checkValidity())return a.stopPropagation(),void ae(!0);var n=Object.assign({},oe,{id_invoice:e.match.params.id});y(!0),n.id?v.a.put(s.b+"invoice_bonds/"+n.id,n).then((function(e){k.b.success("Abono modificado con \xe9xito"),ue(),le()})).catch((function(a){y(!1),e.tokenExpired(a)})):v.a.post(s.b+"invoice_bonds",n).then((function(e){k.b.success("Abono agregado con \xe9xito"),ue(),le()})).catch((function(a){y(!1),e.tokenExpired(a)}))},noValidate:!0,validated:ee},i.a.createElement(i.a.Fragment,null,l?i.a.createElement(E.a.Body,null,i.a.createElement(z.a,null)):i.a.createElement(E.a.Body,null,i.a.createElement(f.a,null,i.a.createElement(j.a,{type:"date",label:"Fecha del Pago",name:"date_payment_bond",required:!0,messageErrors:["Requerido*"],cols:"col-md-4 col-lg-4 col-sm-4",value:oe.date_payment_bond,handleChange:de}),i.a.createElement(j.a,{type:"select",label:"Tipo de Abono",name:"id_type_bond",required:!0,messageErrors:["Requerido*"],cols:"col-md-4 col-lg-4 col-sm-4",value:oe.id_type_bond,handleChange:de},i.a.createElement("option",{value:""},"--Seleccione--"),R.map((function(e,a){return i.a.createElement("option",{value:e.id,key:a},e.name)}))),i.a.createElement(j.a,{type:"number",step:"any",label:"Monto",name:"amount",required:!0,messageErrors:["Requerido*"],cols:"col-md-4 col-lg-4 col-sm-4",value:oe.amount,handleChange:de})),i.a.createElement(f.a,null,i.a.createElement(j.a,{type:"text",label:"Detalle",name:"detail",required:!1,messageErrors:["Requerido*"],cols:"col-md-4 col-lg-4 col-sm-4",value:oe.detail,handleChange:de})))),i.a.createElement(E.a.Footer,null,i.a.createElement(g.a,{size:"md",type:"submit",variant:"primary",disabled:W},"Enviar"),i.a.createElement(g.a,{size:"md",variant:"secondary",onClick:ue,disabled:W},"cerrar")))))}))}}]);
//# sourceMappingURL=63.130f4258.chunk.js.map